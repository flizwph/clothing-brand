# VK Escapism Bot

Бот для сообщества ВКонтакте для управления заказами и интеграции с криптовалютными API.

## Основные возможности

- Оформление заказов через сообщения сообщества
- Управление статусами заказов
- Просмотр информации о заказах
- Получение графиков и цен криптовалют по запросу в формате `$[символ]`
- Связь с администратором
- Интерактивная клавиатура для удобной навигации
- Кэширование данных о криптовалютах

## Технические характеристики

- Java 11+
- PostgreSQL в качестве базы данных
- Hibernate для ORM
- VK API SDK для работы с API ВКонтакте
- JFreeChart для создания графиков
- Jackson для работы с JSON
- Log4j2 для логирования
- Конфигурационные файлы для безопасного хранения токенов и настроек

## Улучшения безопасности и производительности

- Внешняя конфигурация с защитой токенов API
- Повторные попытки для нестабильных HTTP-запросов
- Кэширование данных криптовалют для уменьшения нагрузки на API
- Повышенная безопасность обработки ввода пользователя
- Подробное логирование с разными уровнями детализации

## Установка и запуск

### Предварительные требования

- JDK 11 или выше
- Maven (опционально, скрипт может автоматически скачать и настроить)
- PostgreSQL 11 или выше
- Доступ к API ВКонтакте (токен группы)

### Настройка конфигурации

1. Создайте файл `src/main/resources/config.properties` на основе шаблона:

```properties
# Конфигурация VK API
vk.token=YOUR_VK_TOKEN_HERE
vk.group_id=YOUR_GROUP_ID

# Конфигурация базы данных
db.url=jdbc:postgresql://localhost:5433/vk_escapism
db.user=postgres
db.password=YOUR_DB_PASSWORD

# Настройки HTTP-клиента
http.timeout=10000
http.max_retries=3
```

### Настройка базы данных

1. Создайте базу данных PostgreSQL:

```sql
CREATE DATABASE vk_escapism;
```

2. Настройте пользователя и пароль в файле `src/main/resources/hibernate.cfg.xml`.

### Универсальный скрипт управления

Для работы с ботом используйте универсальный скрипт `vk_bot.bat` (для Windows) или `run_in_powershell.ps1` (для PowerShell):

```
vk_bot.bat [действие]
```

Доступные действия:
- `run` - Запуск бота (с автоматической сборкой при необходимости)
- `build` - Сборка проекта
- `dummy` - Создание тестового JAR-файла
- `clean` - Очистка временных файлов
- `help` - Вывод справки

Примеры:
```
vk_bot.bat run    # Запуск бота
vk_bot.bat build  # Только сборка проекта
```

Скрипт автоматически выполнит:
- Проверку наличия Java и Maven
- Создание Maven Wrapper при необходимости
- Сборку проекта перед запуском
- Создание тестового JAR при сбое сборки (опционально)

## Структура проекта

- `src/main/java/ru/escapismart/config/` - Классы конфигурации
- `src/main/java/ru/escapismart/model/` - Модели данных (User, Order)
- `src/main/java/ru/escapismart/dao/` - DAO для работы с базой данных
- `src/main/java/ru/escapismart/service/` - Бизнес-логика (работа с API, создание графиков)
- `src/main/java/ru/escapismart/keyboard/` - Клавиатуры ВКонтакте
- `src/main/java/ru/escapismart/util/` - Утилиты (HibernateUtil, RetryableHttpClient)
- `src/main/java/ru/escapismart/Main.java` - Основной класс приложения
- `src/main/resources/` - Ресурсы (конфигурация, логирование)

## Функциональность по работе с криптовалютами

Бот поддерживает получение информации о криптовалютах с помощью команд вида `$[SYMBOL]`, например:
- `$BTC` - получить информацию о Bitcoin
- `$ETH` - получить информацию о Ethereum
- `$SOL` - получить информацию о Solana

Дополнительно бот предоставляет интерактивную клавиатуру для выбора популярных криптовалют.

## Решение проблем

### Maven не установлен
Скрипт `vk_bot.bat` автоматически создаст Maven Wrapper и попытается скачать Maven.

### Java не установлена
Установите JDK 11 или новее с [AdoptOpenJDK](https://adoptopenjdk.net/) или [Oracle](https://www.oracle.com/java/technologies/javase-downloads.html).

### Проблемы с PostgreSQL
- Убедитесь, что PostgreSQL запущен на порту 5433
- Проверьте настройки подключения в `hibernate.cfg.xml`
- Создайте базу данных `vk_escapism`

## Логирование

Логи приложения сохраняются в директории `logs/`:
- `logs/vk-bot.log` - основной лог приложения
- `logs/vk-bot-error.log` - лог ошибок

Настройки логирования можно изменить в файле `src/main/resources/log4j2.xml`.

## Лицензия

MIT 