# Clothing Brand - Интернет-магазин одежды с NFT

Проект представляет собой бэкенд для интернет-магазина одежды с интеграцией Telegram, выдачей NFT за покупки и административной панелью управления.

## Архитектура проекта

Проект построен на Spring Boot и использует следующие технологии:
- Spring Boot 3.3
- Spring Security + JWT
- PostgreSQL
- Telegram Bot API
- JPA / Hibernate

## Основные компоненты

### 1. Модуль электронной коммерции
- Управление товарами (CRUD)
- Создание и управление заказами
- Система учета запасов

### 2. Пользовательская система
- Регистрация и аутентификация
- Интеграция с Telegram
- Интеграция с Discord (в разработке)
- Верификация пользователей

### 3. NFT система
- Выдача NFT за покупки
- Система placeholder и reveal NFT после доставки
- Возможность передачи NFT во внешние кошельки

### 4. Telegram интеграция
- Клиентский бот для покупок
- Административный бот для управления заказами

## Схема взаимодействия компонентов

```
┌─────────────────────┐     ┌─────────────────────┐     ┌─────────────────────┐
│                     │     │                     │     │                     │
│  Модуль электронной │     │  Пользовательская   │     │     NFT система     │
│     коммерции       │◄───►│       система       │◄───►│                     │
│                     │     │                     │     │                     │
└─────────┬───────────┘     └─────────┬───────────┘     └─────────┬───────────┘
          │                           │                           │
          │                           │                           │
          │                           ▼                           │
          │             ┌─────────────────────────────┐           │
          └────────────►│                             │◄──────────┘
                        │      Система событий        │
                        │                             │
                        └─────────────┬───────────────┘
                                      │
                                      ▼
                        ┌─────────────────────────────┐
                        │                             │
                        │    Telegram интеграция      │
                        │                             │
                        └─────────────────────────────┘
```

## Логика взаимодействия между сервисами

### 1. Покупка товара
1. Пользователь авторизуется через веб-интерфейс или Telegram-бот
2. Создает заказ через OrderService
3. OrderService публикует событие OrderEvent.CREATED
4. OrderEventHandler обрабатывает событие:
   - Отправляет уведомление пользователю через Telegram (если привязан)
   - Отправляет уведомление администраторам через Admin Bot

### 2. Обновление статуса заказа
1. Администратор обновляет статус через API или Admin Bot
2. OrderService публикует соответствующее событие (PAID, SHIPPED, DELIVERED)
3. OrderEventHandler обрабатывает события:
   - При PAID создает NFT через NFTService
   - Отправляет уведомления пользователю о статусе

### 3. Выдача NFT
1. При оплате заказа создается NFT в статусе placeholder
2. NFTService публикует событие NFTEvent.CREATED
3. NFTEventHandler отправляет уведомление пользователю
4. При доставке заказа NFT раскрывается (REVEALED)
5. Пользователь может передать NFT на внешний кошелек

### 4. Интеграция с Telegram
1. Пользователь может привязать Telegram аккаунт через веб-интерфейс:
   - Генерируется код верификации
   - Код вводится в Telegram-бот
   - UserService связывает аккаунты
2. После привязки:
   - Пользователь получает уведомления о заказах
   - Пользователь может просматривать и покупать товары через бот
   - Пользователь получает уведомления о NFT

## Запуск проекта

### С помощью Docker
```bash
docker-compose up -d
```

### Локально
```bash
mvn spring-boot:run
```

## API документация

Swagger UI доступен по адресу `http://localhost:8080/swagger-ui.html` после запуска приложения.

## Переменные окружения

- `JWT_SECRET` - секретный ключ для JWT
- `JWT_EXPIRATION` - время жизни токена в миллисекундах
- `JWT_REFRESH_EXPIRATION` - время жизни refresh токена в миллисекундах 