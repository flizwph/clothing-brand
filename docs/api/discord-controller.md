# Контроллер для работы с Discord

## Общая информация
Контроллер Discord предоставляет API для привязки, отвязки и проверки статуса Discord-аккаунта пользователя.

- **Базовый путь**: `/api/discord`
- **Реализация**: `DiscordController.java`

## Эндпоинты

### Привязка Discord-аккаунта (через веб-интерфейс)
Привязывает Discord-аккаунт к аккаунту авторизованного пользователя на сайте.

- **URL**: `/api/discord/link`
- **Метод**: `POST`
- **Требует авторизации**: Да (Bearer Token)

**Тело запроса**:
```json
{
  "discordId": 123456789012345678,
  "discordUsername": "user#1234"
}
```

**Успешный ответ (200 OK)**:
```json
{
  "success": true,
  "data": {
    "success": true,
    "message": "Discord аккаунт успешно привязан",
    "username": "user123"
  }
}
```

**Ошибки**:
- `400 Bad Request` - Некорректные данные запроса
- `401 Unauthorized` - Пользователь не авторизован
- `500 Internal Server Error` - Ошибка сервера при привязке аккаунта

### Отвязка Discord-аккаунта
Отвязывает Discord-аккаунт от аккаунта авторизованного пользователя на сайте.

- **URL**: `/api/discord/unlink`
- **Метод**: `POST`
- **Требует авторизации**: Да (Bearer Token)

**Успешный ответ (200 OK)**:
```json
{
  "success": true,
  "data": {
    "success": true,
    "message": "Discord аккаунт успешно отвязан"
  }
}
```

**Ошибки**:
- `401 Unauthorized` - Пользователь не авторизован
- `500 Internal Server Error` - Ошибка сервера при отвязке аккаунта

### Получение статуса привязки Discord-аккаунта
Возвращает информацию о привязанном Discord-аккаунте для авторизованного пользователя.

- **URL**: `/api/discord/status`
- **Метод**: `GET`
- **Требует авторизации**: Да (Bearer Token)

**Успешный ответ (200 OK)**:
```json
{
  "success": true,
  "data": {
    "linked": true,
    "discordUsername": "user#1234",
    "discordId": 123456789012345678
  }
}
```

**Ответ для непривязанного аккаунта (200 OK)**:
```json
{
  "success": true,
  "data": {
    "linked": false,
    "discordUsername": null,
    "discordId": null
  }
}
```

**Ошибки**:
- `401 Unauthorized` - Пользователь не авторизован

### Генерация кода верификации для Discord
Генерирует код верификации для привязки Discord-аккаунта через Discord-бота.

- **URL**: `/api/discord/generate-code`
- **Метод**: `GET`
- **Требует авторизации**: Да (Bearer Token)

**Успешный ответ (200 OK)**:
```json
{
  "code": "a1b2c3d4",
  "message": "Используйте этот код в Discord боте с командой !link"
}
```

**Ошибки**:
- `400 Bad Request` - Не удалось сгенерировать код верификации
- `401 Unauthorized` - Пользователь не авторизован

### Верификация Discord-аккаунта (через Discord-бота)
Привязывает Discord-аккаунт к аккаунту пользователя на сайте по коду верификации.

- **URL**: `/api/discord/verify`
- **Метод**: `POST`
- **Требует авторизации**: Нет

**Тело запроса**:
```json
{
  "code": "a1b2c3d4",
  "discordId": 123456789012345678,
  "discordUsername": "user#1234"
}
```

**Успешный ответ (200 OK)**:
```json
{
  "success": true,
  "message": "Discord аккаунт успешно привязан"
}
```

**Ошибки**:
- `400 Bad Request` - Неверный код верификации

### Проверка статуса верификации (через Discord-бота)
Проверяет, привязан ли Discord-аккаунт к аккаунту на сайте.

- **URL**: `/api/discord/check-status`
- **Метод**: `POST`
- **Требует авторизации**: Нет

**Тело запроса**:
```json
{
  "discordId": 123456789012345678,
  "discordUsername": "user#1234"
}
```

**Успешный ответ (200 OK)**:
```json
{
  "success": true,
  "message": "Ваш аккаунт успешно привязан к сайту! Имя пользователя: user123",
  "username": "user123",
  "telegramHandle": "@telegramUser"
}
```

**Ответ для непривязанного аккаунта (200 OK)**:
```json
{
  "success": false,
  "message": "Аккаунт не найден. Пожалуйста, завершите верификацию на сайте."
}
```

**Ошибки**:
- `500 Internal Server Error` - Ошибка сервера при проверке статуса верификации